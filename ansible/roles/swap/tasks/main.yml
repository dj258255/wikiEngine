# AMD 1GB 인스턴스용 Swap 설정 (1GB)
- name: Swap 파일 존재 여부 확인
  stat:
    path: /swapfile
  register: swap_file
  tags: [swap]

- name: Swap 설정
  when: not swap_file.stat.exists
  tags: [swap]
  block:
    - name: 1GB Swap 파일 생성
      command: dd if=/dev/zero of=/swapfile bs=1M count=1024

    - name: Swap 파일 권한 설정
      file:
        path: /swapfile
        mode: "0600"

    - name: Swap 포맷
      command: mkswap /swapfile

    - name: Swap 활성화
      command: swapon /swapfile

    - name: fstab에 Swap 등록 (영구 적용)
      lineinfile:
        path: /etc/fstab
        line: "/swapfile swap swap defaults 0 0"
        state: present

    - name: Swappiness 설정 (10)
      ansible.posix.sysctl:
        name: vm.swappiness
        value: "10"
        state: present
        sysctl_set: true
